apiVersion: apps/v1
kind: Deployment

metadata:
  name: evaluation-deployment
  namespace: toggle-master
  labels:
    app: evaluation
    tier: backend

spec:
  replicas: 2

  selector:
    matchLabels:
      app: evaluation
      tier: backend

  template:
    metadata:
      labels:
        app: evaluation
        tier: backend

    spec:
      containers:
        - name: evaluation-container
          image: kind-registry:5000/toggle-master-microservices-evaluation-service
          imagePullPolicy: Always
          ports:
            - containerPort: 8004
          env:
            - name: PORT
              value: "8004"
            - name: AWS_REGION
              value: us-east-1
            - name: AWS_ACCESS_KEY_ID
              value: test
            - name: AWS_SECRET_ACCESS_KEY
              value: test
            - name: AWS_ENDPOINT_URL
              value: http://172.21.0.1:4566
            - name: AWS_SQS_URL
              value: http://172.21.0.1:4566/000000000000/toggle-analytics-queue
            - name: AUTH_SERVICE_URL
              value: "http://auth-service:8001"
            - name: FLAG_SERVICE_URL
              value: "http://flag-service:8002"
            - name: TARGETING_SERVICE_URL
              value: "http://targeting-service:8003"
            - name: REDIS_URL
              value: "redis://172.21.0.1:6379"
            - name: SERVICE_API_KEY
              value: "tm_key_xxx" # chave criada manualmente no auth-service (inserir dinamicamente via Secret é o próximo step)
          resources:
            limits:
              memory: "256Mi"
              cpu: "500m"
            requests:
              memory: "128Mi"
              cpu: "250m"
