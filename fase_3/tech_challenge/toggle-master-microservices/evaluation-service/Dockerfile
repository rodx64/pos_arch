# ==========================
# üèóÔ∏è STAGE 1 ‚Äî Builder
# ==========================
# Este est√°gio monta um ambiente tempor√°rio para COMPILAR a aplica√ß√£o Go.
# Inclui o Go completo para build
FROM golang:1.21-alpine AS builder

# Diret√≥rio de trabalho
WORKDIR /app

# Instala ferramentas necess√°rias (ex: git para baixar depend√™ncias)
RUN apk add --no-cache git

# Copia os arquivos de mod e sum primeiro para aproveitar cache do Docker
COPY go.mod go.sum ./

# Baixa as depend√™ncias sem alterar go.mod e go.sum
RUN go mod download

# Copia todo o c√≥digo da aplica√ß√£o
COPY . .

# Compila a aplica√ß√£o em um bin√°rio est√°tico
RUN go build -o evaluation-service .

# ==========================
# üß© STAGE 2 ‚Äî Runtime final
# ==========================
# Container final leve, apenas com o bin√°rio compilado (Por ser bin√°rio n√£o precisa do Go)
FROM alpine:latest

RUN apk add --no-cache curl

# Diret√≥rio de trabalho
WORKDIR /app

# Copia o bin√°rio do builder
COPY --from=builder /app/evaluation-service .

# Copia arquivos de configura√ß√£o se necess√°rio (.env etc)
# COPY .env .  # opcional, apenas se quiser usar em dev

# Exp√µe a porta do servi√ßo
EXPOSE 8004

# Comando padr√£o para rodar o servi√ßo
CMD ["./evaluation-service"]
